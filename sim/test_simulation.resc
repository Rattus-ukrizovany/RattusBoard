# RattusBoard Simulation Test Script
# Quick validation test for the simulation environment

# Load platform and show system info
mach create "rattusboard_test"
machine LoadPlatformDescription @rattusboard.repl

echo "=== RattusBoard Simulation Test ==="
echo "Platform loaded successfully!"

# Test GPIO initialization
gpio

# Test basic pin states
echo "Testing basic pin configuration..."
gpio.hand_detect Press
echo "Hand detection set to LEFT (GP21 low)"

gpio.hand_detect Release  
echo "Hand detection set to RIGHT (GP21 high)"

# Test matrix simulation
echo "Testing matrix pins..."
gpio.left_col0 Press
gpio.matrix_row0 Press
echo "Left matrix key pressed (Col0, Row0)"

gpio.left_col0 Release
gpio.matrix_row0 Release
echo "Left matrix key released"

# Test right half components  
echo "Testing right half components..."
gpio.right_col0 Press
gpio.matrix_row1 Press
echo "Right matrix key pressed (Col0, Row1)"

gpio.right_col0 Release
gpio.matrix_row1 Release  
echo "Right matrix key released"

# Test PMW3360 interface
echo "Testing PMW3360 interface..."
gpio.pmw3360_cs Press
gpio.pmw3360_cs Release
echo "PMW3360 CS pin toggled"

# Test encoder
echo "Testing encoder pins..."
gpio.encoder_a Press
gpio.encoder_b Press
gpio.encoder_a Release
gpio.encoder_b Release
echo "Encoder pins tested"

echo "=== Test completed successfully! ==="
echo "All components initialized and responsive."
echo "Platform ready for firmware testing."

quit